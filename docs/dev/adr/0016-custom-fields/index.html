<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="Eike Kettner">
<meta name="description" content="Docspell is a Document Management System (DMS), a system that asists in organizing your piles of documents, resulting from scanners, e-mails and other sources with miminal effort.">
<meta name="keywords" content="document management system dms organizer ocr open source free scan pdf word doc archive gpl machine learning nlp auto tagging"/>
<meta name="robots" content="index,follow"/>
<meta name="image" property="og:image" content="/img/poster.png">
<meta name="title" property="og:title" content="Docspell – Simple Document Organizer">
<meta name="og:image" content="/img/poster.png">
<meta name="og:title" content="Docspell – Simple Document Organizer">
<meta name="og:site_name" content="Custom Fields - Docspell">
<meta name="og:url" content="">
<meta name="og:type" content="website">
<meta name="og:description" content="Simple Document Organizer">
<meta name="twitter:title" content="Docspell">
<meta name="twitter:image" content="/img/poster.png">
<meta name="twitter:description" content="Simple Document Organizer">
<meta name="twitter:card" content="summary_large_image">

<link rel="shortcut icon" href="/favicon-mc.ico" type="image/x-icon">
<link rel="icon" href="/favicon-mc.ico" type="image/x-icon">

        <title>Custom Fields – Docspell Documentation</title>
        <link rel="stylesheet" href="/styles.css">
    </head>
    <body>
        <section class="hero is-info is-small">
            <div class="hero-head">
                <nav class="navbar">
    <div class="navbar-brand">
        <a class="navbar-item" href="/">
            <span class="icon">
                <img src="/icons/logo-only-36.svg">
            </span>
            <span>
                Docspell
            </span>
        </a>
    </div>
    <div class="navbar-start">
        <a target="_blank"
           href="https://github.com/eikek/docspell"
           class="navbar-item">
            <span class="icon">
                <img src="/icons/github-40.svg">
            </span>
            <span>
                Github
            </span>
        </a>
    </div>
</nav>

            </div>
            <div class="hero-body">
                <div class="columns is-vcentered">
                    <div class="column is-8">
                        <h1 class="title">
                            Custom Fields
                        </h1>
                        <h2 class="subtitle">
                            Docspell Documentation
                        </h2>
                    </div>
                    <div class="column">
                        <id id="search"></id>
                    </div>
                </div>
            </div>
        </section>
        <nav class="breadcrumb has-succeeds-separator" aria-label="breadcrumbs"
             style="position:sticky; top: 0; z-index:10;">
            <ul>
                
                
                <li>
                    <a href="https:&#x2F;&#x2F;docspell.org&#x2F;"></a>
                </li>
                
                
                <li>
                    <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;">Overview</a>
                </li>
                
                
                <li>
                    <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;dev&#x2F;">Development</a>
                </li>
                
                
                <li>
                    <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;dev&#x2F;adr&#x2F;">ADRs</a>
                </li>
                
                <li>
                    <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;dev&#x2F;adr&#x2F;0016-custom-fields&#x2F;">Custom Fields</a>
                </li>
            </ul>
        </nav>

        <section class="section pt-2">
            <div class="columns is-desktop">
                <div class="column is-3">
                    <div class="menu"
                         style="position:sticky; top:2rem; z-index:10;">
                        <ul class="menu-list">
                            
                            

                            <p class="menu-label">
                                ADRs
                            </p>
                            
                            
                            <li>
                                <a href="https://docspell.org/docs/dev/adr/0000-use-markdown-architectural-decision-records/"
                                   >
                                    Use Markdown Architectural Decision Records
                                </a>
                                
                            </li>
                            
                            
                            <li>
                                <a href="https://docspell.org/docs/dev/adr/0001-components/"
                                   >
                                    Components
                                </a>
                                
                            </li>
                            
                            
                            <li>
                                <a href="https://docspell.org/docs/dev/adr/0002-component-interaction/"
                                   >
                                    Component Interaction
                                </a>
                                
                            </li>
                            
                            
                            <li>
                                <a href="https://docspell.org/docs/dev/adr/0003-encryption/"
                                   >
                                    Encryption
                                </a>
                                
                            </li>
                            
                            
                            <li>
                                <a href="https://docspell.org/docs/dev/adr/0004-iso8601vsepoch/"
                                   >
                                    Iso8601 Vs Millis As Date-Time Transfer
                                </a>
                                
                            </li>
                            
                            
                            <li>
                                <a href="https://docspell.org/docs/dev/adr/0005-job-executor/"
                                   >
                                    Joex - Job Executor
                                </a>
                                
                            </li>
                            
                            
                            <li>
                                <a href="https://docspell.org/docs/dev/adr/0006-more-file-types/"
                                   >
                                    More File Types
                                </a>
                                
                            </li>
                            
                            
                            <li>
                                <a href="https://docspell.org/docs/dev/adr/0007-convert-html-files/"
                                   >
                                    Convert Html Files
                                </a>
                                
                            </li>
                            
                            
                            <li>
                                <a href="https://docspell.org/docs/dev/adr/0008-convert-plain-text/"
                                   >
                                    Convert Text Files
                                </a>
                                
                            </li>
                            
                            
                            <li>
                                <a href="https://docspell.org/docs/dev/adr/0009-convert-office-docs/"
                                   >
                                    Convert Office Documents
                                </a>
                                
                            </li>
                            
                            
                            <li>
                                <a href="https://docspell.org/docs/dev/adr/0010-convert-image-files/"
                                   >
                                    Convert Image Files
                                </a>
                                
                            </li>
                            
                            
                            <li>
                                <a href="https://docspell.org/docs/dev/adr/0011-extract-text/"
                                   >
                                    Extract Text From Files
                                </a>
                                
                            </li>
                            
                            
                            <li>
                                <a href="https://docspell.org/docs/dev/adr/0012-periodic-tasks/"
                                   >
                                    Periodic Tasks
                                </a>
                                
                            </li>
                            
                            
                            <li>
                                <a href="https://docspell.org/docs/dev/adr/0013-archive-files/"
                                   >
                                    Archive Files
                                </a>
                                
                            </li>
                            
                            
                            <li>
                                <a href="https://docspell.org/docs/dev/adr/0014-fulltext-search-engine/"
                                   >
                                    Fulltext Search Engine
                                </a>
                                
                            </li>
                            
                            
                            <li>
                                <a href="https://docspell.org/docs/dev/adr/0015-convert-pdf-files/"
                                   >
                                    Convert Pdf Files
                                </a>
                                
                            </li>
                            
                            
                            <li>
                                <a href="https://docspell.org/docs/dev/adr/0016-custom-fields/"
                                   class="is-active">
                                    Custom Fields
                                </a>
                                
                                <ul class="menu-list">
                                    
                                    <li>
                                        <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;dev&#x2F;adr&#x2F;0016-custom-fields&#x2F;#context-and-problem-statement">
                                            Context and Problem Statement
                                        </a>
                                        <ul>
                                            
                                        </ul>
                                    </li>
                                    
                                    <li>
                                        <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;dev&#x2F;adr&#x2F;0016-custom-fields&#x2F;#considered-options">
                                            Considered Options
                                        </a>
                                        <ul>
                                            
                                            <li>
                                                <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;dev&#x2F;adr&#x2F;0016-custom-fields&#x2F;#requirements">
                                                    Requirements
                                                </a>
                                            </li>
                                            
                                            <li>
                                                <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;dev&#x2F;adr&#x2F;0016-custom-fields&#x2F;#ideas">
                                                    Ideas
                                                </a>
                                            </li>
                                            
                                        </ul>
                                    </li>
                                    
                                    <li>
                                        <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;dev&#x2F;adr&#x2F;0016-custom-fields&#x2F;#decision-outcome">
                                            Decision Outcome
                                        </a>
                                        <ul>
                                            
                                            <li>
                                                <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;dev&#x2F;adr&#x2F;0016-custom-fields&#x2F;#initial-version">
                                                    Initial Version
                                                </a>
                                            </li>
                                            
                                        </ul>
                                    </li>
                                    
                                </ul>
                                
                            </li>
                            
                        </ul>
                    </div>
                </div>

                <div class="column is-9">
                    <div class="container">
                        <div class="content doc">
                            <h1 id="context-and-problem-statement">Context and Problem Statement<a class="zola-anchor" href="#context-and-problem-statement" aria-label="Anchor link for: context-and-problem-statement">🔗</a></h1>
<p>Users want to add custom metadata to items. For example, for invoices
fields like <code>invoice-number</code> or <code>total</code>/<code>amount</code> make sense. When
using a pagination stamp, every item gets a pagination number.</p>
<p>This is currently not possible to realize in docspell. But it is an
essential part when organizing and archiving documents. It should be
supported.</p>
<h1 id="considered-options">Considered Options<a class="zola-anchor" href="#considered-options" aria-label="Anchor link for: considered-options">🔗</a></h1>
<h2 id="requirements">Requirements<a class="zola-anchor" href="#requirements" aria-label="Anchor link for: requirements">🔗</a></h2>
<ul>
<li>Fields have simple types: There is a difference in presenting a
date, string or number. At least some simple types should be
distinguishable for the UI to make it more convenient to use.</li>
<li>An item can have at most one value of a field: The typical example
is <code>invoice number</code> – it doesn't make sense to be able to specify
two invoice-numbers on an item. If still necessary, one can create
artificial fields like <code>invoice-number-1</code> and <code>invoice-number-2</code>.</li>
<li>Fulltext Index: should custom field values be sent to the full-text
index?
<ul>
<li>This is not required, imho. At least not for a start.</li>
</ul>
</li>
<li>Fields are stored per collective. When creating a new field, user
can select from existing ones to avoid creating same fields with
different names.</li>
<li>Fields can be managed: Rename, change type, delete. Show fields that
don't have any value associated and could be deleted.</li>
</ul>
<h2 id="ideas">Ideas<a class="zola-anchor" href="#ideas" aria-label="Anchor link for: ideas">🔗</a></h2>
<h3 id="database">Database<a class="zola-anchor" href="#database" aria-label="Anchor link for: database">🔗</a></h3>
<p>Initial sketch:</p>
<pre data-lang="sql" style="background-color:#282828;color:#fdf4c1aa;" class="language-sql "><code class="language-sql" data-lang="sql"><span style="color:#fa5c4b;">CREATE TABLE </span><span style="color:#8ec07c;">custom_field</span><span> (
</span><span>  id </span><span style="color:#fa5c4b;">varchar</span><span>(</span><span style="color:#d3869b;">244</span><span>) </span><span style="color:#fe8019;">not </span><span style="color:#d3869b;">null </span><span style="color:#fa5c4b;">primary key</span><span>,
</span><span>  name </span><span style="color:#fa5c4b;">varchar</span><span>(</span><span style="color:#d3869b;">100</span><span>) </span><span style="color:#fe8019;">not </span><span style="color:#d3869b;">null</span><span>,
</span><span>  cid </span><span style="color:#fa5c4b;">varchar</span><span>(</span><span style="color:#d3869b;">254</span><span>) </span><span style="color:#fe8019;">not </span><span style="color:#d3869b;">null</span><span>,
</span><span>  ftype </span><span style="color:#fa5c4b;">varchar</span><span>(</span><span style="color:#d3869b;">100</span><span>) </span><span style="color:#fe8019;">not </span><span style="color:#d3869b;">null</span><span>,
</span><span>  </span><span style="color:#fa5c4b;">foreign key </span><span style="color:#b8bb26;">&quot;cid&quot; </span><span style="color:#fa5c4b;">references</span><span> collective(cid),
</span><span>  unique (cid, name)
</span><span>);
</span><span>
</span><span style="color:#fa5c4b;">CREATE TABLE </span><span style="color:#8ec07c;">custom_field_item_value</span><span> (
</span><span>  id </span><span style="color:#fa5c4b;">varchar</span><span>(</span><span style="color:#d3869b;">254</span><span>) </span><span style="color:#fe8019;">not </span><span style="color:#d3869b;">null </span><span style="color:#fa5c4b;">primary key</span><span>,
</span><span>  item_id </span><span style="color:#fa5c4b;">varchar</span><span>(</span><span style="color:#d3869b;">254</span><span>) </span><span style="color:#fe8019;">not </span><span style="color:#d3869b;">null</span><span>,
</span><span>  field </span><span style="color:#fa5c4b;">varchar</span><span>(</span><span style="color:#d3869b;">254</span><span>) </span><span style="color:#fe8019;">not </span><span style="color:#d3869b;">null</span><span>,
</span><span>  field_value </span><span style="color:#fa5c4b;">varchar</span><span>(</span><span style="color:#d3869b;">254</span><span>),
</span><span>  </span><span style="color:#fa5c4b;">foreign key</span><span> item_id </span><span style="color:#fa5c4b;">references</span><span> item(id),
</span><span>  </span><span style="color:#fa5c4b;">foreign key</span><span> field </span><span style="color:#fa5c4b;">references</span><span> custom_field(id),
</span><span>  unique (item_id, field) </span><span style="font-style:italic;color:#928374;">-- only one value allowed per item
</span><span>)
</span></code></pre>
<ul>
<li>field carries the type in the column <code>ftype</code>. type is an enum:
<code>text</code>, <code>numeric</code>, <code>date</code>, <code>money</code>, <code>bool</code></li>
<li>the type is just some constant, the database doesn't care and can't
enforce anything</li>
<li>the field name is unique per collective</li>
<li>a value to a field can only exist on an item</li>
<li>only one value per item can be created for one field</li>
<li>the values are represented as a string in the database</li>
<li>the application is responsible for converting into a string</li>
<li>date is a local date, the iso format is used (e.g. <code>2020-08-11</code>)</li>
<li>Why not each type a separate column, like <code>value_str</code>, <code>value_date</code>
etc?
<ul>
<li>making them different requires to fetch all fields first before
running a query, in order to know which columns to check
<ul>
<li>usually the query would look like this: <code>my_field_1 == &quot;test&quot;</code>;
in order to know what column to check for <code>my_field_1</code>, a query
to fetch the field must be done first. Only then the type is
known and its clear what column to use for the value. This
complicates searching and increases query count.</li>
</ul>
</li>
<li>The value must be present (or converted) into the target type</li>
<li>It's a lot simpler for the implementation to reduce every custom
field to a string value at the database. Type-specific queries
(like avg, sum etc) can still be done using sql <code>CAST</code> function.</li>
</ul>
</li>
</ul>
<p>Changing Type:</p>
<ul>
<li>change the type on the <code>custom_field</code> table</li>
<li>the string must be convertible to the new type, which must be
ensured by the application</li>
</ul>
<p>Adding more types:</p>
<ul>
<li>ammend the <code>ftype</code> enum with a new value and provide conversion
functions</li>
</ul>
<h3 id="rest-api">REST Api<a class="zola-anchor" href="#rest-api" aria-label="Anchor link for: rest-api">🔗</a></h3>
<ul>
<li>the known field types must be transferred to the ui</li>
<li>the ui creates custom presentation for date, money etc</li>
</ul>
<p>Input 1:</p>
<ul>
<li>setting one value for a specific field. The server knows its type
and converts accordingly (e.g. string-&gt;date)</li>
<li>json only knows number, strings and bools (and null).</li>
<li>make a structure to allow to specify all json types:<pre data-lang="elm" style="background-color:#282828;color:#fdf4c1aa;" class="language-elm "><code class="language-elm" data-lang="elm"><span style="color:#fabd2f;">{</span><span> value_str</span><span style="color:#fe8019;">: </span><span style="color:#fdf4c1;">Maybe String
</span><span style="color:#fabd2f;">,</span><span> value_num</span><span style="color:#fe8019;">: </span><span style="color:#fdf4c1;">Maybe Float
</span><span style="color:#fabd2f;">,</span><span> value_bool</span><span style="color:#fe8019;">: </span><span style="color:#fdf4c1;">Maybe Bool
</span><span style="color:#fabd2f;">}
</span></code></pre>
</li>
<li>con: setting all to <code>Nothing</code> is an error as well as using the wrong
field with some type (e.g. setting <code>value_str</code> for setting a
<code>numeric</code> field)</li>
<li>con: very confusing – what to use for fields of type &quot;date&quot; or
&quot;money&quot;?</li>
<li>client needs some parsing anyways to show errors</li>
</ul>
<p>Input 2:</p>
<ul>
<li>send one value as a string<pre data-lang="elm" style="background-color:#282828;color:#fdf4c1aa;" class="language-elm "><code class="language-elm" data-lang="elm"><span style="color:#fabd2f;">{</span><span> value</span><span style="color:#fe8019;">: </span><span style="color:#fdf4c1;">String
</span><span style="color:#fabd2f;">}
</span></code></pre>
</li>
<li>string must be in a specific format according to its type. server
may convert (like <code>12.4999</code> → <code>12.49</code>), or report an error</li>
<li>client must create the correct string</li>
</ul>
<p>Output:</p>
<ul>
<li>server sends field name, type and value per custom field. Return an
array of objects per item.</li>
</ul>
<p>Searching:</p>
<ul>
<li>UI knows all fields of a collective: user selects one in a dropdown
and specifies the value</li>
</ul>
<h1 id="decision-outcome">Decision Outcome<a class="zola-anchor" href="#decision-outcome" aria-label="Anchor link for: decision-outcome">🔗</a></h1>
<ul>
<li>values are strings at the database</li>
<li>values are strings when transported from/to server</li>
<li>client must provide the correct formatted strings per type
<ul>
<li>numeric: some decimal number</li>
<li>money: decimal number</li>
<li>text: no restrictions</li>
<li>date: a local date as iso string, e.g. <code>2011-10-09</code></li>
<li>bool: either <code>&quot;true&quot;</code> or <code>&quot;false&quot;</code>, case insensitive</li>
</ul>
</li>
</ul>
<h2 id="initial-version">Initial Version<a class="zola-anchor" href="#initial-version" aria-label="Anchor link for: initial-version">🔗</a></h2>
<ul>
<li>create the database structure and a REST api to work with custom
fields</li>
<li>create a UI on item detail to add/set custom fields</li>
<li>show custom fields on item detail</li>
<li>create a page to manage fields: only rename and deletion</li>
<li>extend the search for custom fields</li>
<li>show custom fields in search results</li>
</ul>

                        </div>
                    </div>
                </div>
            </div>
        </section>

        <footer class="footer">
    <div class="container">
        <div class="content has-text-centered">
            <span>
                Docspell 0.30.1
            </span>
            <span class="ml-1 mr-1">•</span>
            <a href="https://spdx.org/licenses/AGPL-3.0-or-later.html" target="_blank">AGPLv3+</a>
            <span class="ml-1 mr-1">•</span>
            <a href="https://github.com/eikek/docspell" target="_blank">
                Source Code
            </a>
            <span class="ml-1 mr-1">•</span>
            <span>
                Chat on <a href="https://gitter.im/eikek/docspell">Gitter</a>/<a href="https://app.element.io/#/room/#eikek_docspell:gitter.im">Matrix</a>
            </span>
        </div>
    </div>
    
</footer>

        <script type="text/javascript" src="https://docspell.org/elasticlunr.min.js"></script>
<script type="text/javascript" src="https://docspell.org/search_index.en.js"></script>
<script type="text/javascript" src="https://docspell.org/js/searchhelper.js"></script>
<script type="text/javascript" src="https://docspell.org/js/bundle.js"></script>

        <script>
 var initSearch = function() {
     var elmSearch = Elm.Search.init({
         node: document.getElementById("search"),
         flags: {}
     });
     initElmSearch(elmSearch);
 }
 if (document.readyState === "complete" ||
     (document.readyState !== "loading" && !document.documentElement.doScroll)
 ) {
     initSearch();
 } else {
     document.addEventListener("DOMContentLoaded", initSearch);
 }
</script>

        <!-- Fathom - simple website analytics - https://github.com/usefathom/fathom -->
<script>
 (function(f, a, t, h, o, m){
     a[h]=a[h]||function(){
         (a[h].q=a[h].q||[]).push(arguments)
     };
     o=f.createElement('script'),
     m=f.getElementsByTagName('script')[0];
     o.async=1; o.src=t; o.id='fathom-script';
     m.parentNode.insertBefore(o,m)
 })(document, window, '//webstats.daheim.site/tracker.js', 'fathom');
 fathom('set', 'siteId', 'OGJDF');
 fathom('trackPageview');
</script>
<!-- / Fathom -->

    </body>
</html>
