<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="Eike Kettner">
<meta name="description" content="Docspell is a Document Management System (DMS), a system that asists in organizing your piles of documents, resulting from scanners, e-mails and other sources with miminal effort.">
<meta name="keywords" content="document management system dms organizer ocr open source free scan pdf word doc archive gpl machine learning nlp auto tagging"/>
<meta name="robots" content="index,follow"/>
<meta name="image" property="og:image" content="/img/poster.png">
<meta name="title" property="og:title" content="Docspell â€“ Simple Document Organizer">
<meta name="og:image" content="/img/poster.png">
<meta name="og:title" content="Docspell â€“ Simple Document Organizer">
<meta name="og:site_name" content="Joex - Docspell">
<meta name="og:url" content="">
<meta name="og:type" content="website">
<meta name="og:description" content="Simple Document Organizer">
<meta name="twitter:title" content="Docspell">
<meta name="twitter:image" content="/img/poster.png">
<meta name="twitter:description" content="Simple Document Organizer">
<meta name="twitter:card" content="summary_large_image">

<link rel="shortcut icon" href="/favicon-mc.ico" type="image/x-icon">
<link rel="icon" href="/favicon-mc.ico" type="image/x-icon">

        <title>Joex â€“ Docspell Documentation</title>
        <link rel="stylesheet" href="/styles.css">
    </head>
    <body>
        <section class="hero is-info is-small">
            <div class="hero-head">
                <nav class="navbar">
    <div class="navbar-brand">
        <a class="navbar-item" href="/">
            <span class="icon">
                <img src="/icons/logo-only-36.svg">
            </span>
            <span>
                Docspell
            </span>
        </a>
    </div>
    <div class="navbar-start">
        <a target="_blank"
           href="https://github.com/eikek/docspell"
           class="navbar-item">
            <span class="icon">
                <img src="/icons/github-40.svg">
            </span>
            <span>
                Github
            </span>
        </a>
    </div>
</nav>

            </div>
            <div class="hero-body">
                <div class="columns is-vcentered">
                    <div class="column is-8">
                        <h1 class="title">
                            Joex
                        </h1>
                        <h2 class="subtitle">
                            Docspell Documentation
                        </h2>
                    </div>
                    <div class="column">
                        <id id="search"></id>
                    </div>
                </div>
            </div>
        </section>
        <nav class="breadcrumb has-succeeds-separator" aria-label="breadcrumbs"
             style="position:sticky; top: 0; z-index:10;">
            <ul>
                
                
                <li>
                    <a href="https:&#x2F;&#x2F;docspell.org&#x2F;"></a>
                </li>
                
                
                <li>
                    <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;">Overview</a>
                </li>
                
                
                <li>
                    <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;joex&#x2F;">Joex</a>
                </li>
                
                <li>
                    <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;joex&#x2F;intro&#x2F;">Joex</a>
                </li>
            </ul>
        </nav>

        <section class="section pt-2">
            <div class="columns is-desktop">
                <div class="column is-3">
                    <div class="menu"
                         style="position:sticky; top:2rem; z-index:10;">
                        <ul class="menu-list">
                            
                            

                            <p class="menu-label">
                                Joex
                            </p>
                            
                            
                            <li>
                                <a href="https://docspell.org/docs/joex/intro/"
                                   class="is-active">
                                    Joex
                                </a>
                                
                                <ul class="menu-list">
                                    
                                    <li>
                                        <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;joex&#x2F;intro&#x2F;#introduction">
                                            Introduction
                                        </a>
                                        <ul>
                                            
                                        </ul>
                                    </li>
                                    
                                    <li>
                                        <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;joex&#x2F;intro&#x2F;#task-vs-job">
                                            Task vs Job
                                        </a>
                                        <ul>
                                            
                                        </ul>
                                    </li>
                                    
                                    <li>
                                        <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;joex&#x2F;intro&#x2F;#scheduler-and-queue">
                                            Scheduler and Queue
                                        </a>
                                        <ul>
                                            
                                        </ul>
                                    </li>
                                    
                                    <li>
                                        <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;joex&#x2F;intro&#x2F;#scheduler-config">
                                            Scheduler Config
                                        </a>
                                        <ul>
                                            
                                        </ul>
                                    </li>
                                    
                                    <li>
                                        <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;joex&#x2F;intro&#x2F;#periodic-tasks">
                                            Periodic Tasks
                                        </a>
                                        <ul>
                                            
                                        </ul>
                                    </li>
                                    
                                    <li>
                                        <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;joex&#x2F;intro&#x2F;#starting-on-demand">
                                            Starting on demand
                                        </a>
                                        <ul>
                                            
                                        </ul>
                                    </li>
                                    
                                    <li>
                                        <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;joex&#x2F;intro&#x2F;#shutting-down">
                                            Shutting down
                                        </a>
                                        <ul>
                                            
                                        </ul>
                                    </li>
                                    
                                </ul>
                                
                            </li>
                            
                            
                            <li>
                                <a href="https://docspell.org/docs/joex/file-processing/"
                                   >
                                    File Processing
                                </a>
                                
                            </li>
                            
                        </ul>
                    </div>
                </div>

                <div class="column is-9">
                    <div class="container">
                        <div class="content doc">
                            <h1 id="introduction">Introduction<a class="zola-anchor" href="#introduction" aria-label="Anchor link for: introduction">ðŸ”—</a></h1>
<p>Joex is short for <em>Job Executor</em> and it is the component managing long
running tasks in docspell. One of these long running tasks is the file
processing task.</p>
<p>One joex component handles the processing of all files of all
collectives/users. It requires much more resources than the rest
server component. Therefore the number of jobs that can run in
parallel is limited with respect to the hardware it is running on.</p>
<p>For larger installations, it is probably better to run several joex
components on different machines. That works out of the box, as long
as all components point to the same database and use different
<code>app-id</code>s (see <a href="https://docspell.org/docs/configure/#app-id">configuring
docspell</a>).</p>
<p>When files are submitted to docspell, they are stored in the database
and all known joex components are notified about new work. Then they
compete on getting the next job from the queue. After a job finishes
and no job is waiting in the queue, joex will sleep until notified
again. It will also periodically notify itself as a fallback.</p>
<h1 id="task-vs-job">Task vs Job<a class="zola-anchor" href="#task-vs-job" aria-label="Anchor link for: task-vs-job">ðŸ”—</a></h1>
<p>Just for the sake of this document, a task denotes the code that has
to be executed or the thing that has to be done. It emerges in a job,
once a task is submitted into the queue from where it will be picked
up and executed eventually. A job maintains a state and other things,
while a task is just code.</p>
<h1 id="scheduler-and-queue">Scheduler and Queue<a class="zola-anchor" href="#scheduler-and-queue" aria-label="Anchor link for: scheduler-and-queue">ðŸ”—</a></h1>
<p>The scheduler is the part that runs and monitors the long running
jobs. It works together with the job queue, which defines what job to
take next.</p>
<p>To create a somewhat fair distribution among multiple collectives, a
collective is first chosen in a simple round-robin way. Then a job
from this collective is chosen by priority.</p>
<p>There are only two priorities: low and high. A simple <em>counting
scheme</em> determines if a low prio or high prio job is selected
next. The default is <code>4, 1</code>, meaning to first select 4 high priority
jobs and then 1 low priority job, then starting over. If no such job
exists, its falls back to the other priority.</p>
<p>The priority can be set on a <em>Source</em> (see
<a href="https://docspell.org/docs/webapp/uploading/">uploads</a>). Uploading through the web
application will always use priority <em>high</em>. The idea is that while
logged in, jobs are more important that those submitted when not
logged in.</p>
<h1 id="scheduler-config">Scheduler Config<a class="zola-anchor" href="#scheduler-config" aria-label="Anchor link for: scheduler-config">ðŸ”—</a></h1>
<p>The relevant part of the config file regarding the scheduler is shown
below with some explanations.</p>
<pre data-lang="bash" style="background-color:#282828;color:#fdf4c1aa;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#fdf4c1;">docspell.joex {
</span><span style="color:#fdf4c1;">  </span><span style="font-style:italic;color:#928374;"># other settings left out for brevity
</span><span style="color:#fdf4c1;">
</span><span style="color:#fdf4c1;">  scheduler {
</span><span style="color:#fdf4c1;">
</span><span style="color:#fdf4c1;">    </span><span style="font-style:italic;color:#928374;"># Number of processing allowed in parallel.
</span><span style="color:#fdf4c1;">    pool-size = 2
</span><span style="color:#fdf4c1;">
</span><span style="color:#fdf4c1;">    </span><span style="font-style:italic;color:#928374;"># A counting scheme determines the ratio of how high- and low-prio
</span><span style="color:#fdf4c1;">    </span><span style="font-style:italic;color:#928374;"># jobs are run. For example: 4,1 means run 4 high prio jobs, then
</span><span style="color:#fdf4c1;">    </span><span style="font-style:italic;color:#928374;"># 1 low prio and then start over.
</span><span style="color:#fdf4c1;">    counting-scheme = </span><span style="color:#b8bb26;">&quot;4,1&quot;
</span><span style="color:#fdf4c1;">
</span><span style="color:#fdf4c1;">    </span><span style="font-style:italic;color:#928374;"># How often a failed job should be retried until it enters failed
</span><span style="color:#fdf4c1;">    </span><span style="font-style:italic;color:#928374;"># state. If a job fails, it becomes &quot;stuck&quot; and will be retried
</span><span style="color:#fdf4c1;">    </span><span style="font-style:italic;color:#928374;"># after a delay.
</span><span style="color:#fdf4c1;">    retries = 5
</span><span style="color:#fdf4c1;">
</span><span style="color:#fdf4c1;">    </span><span style="font-style:italic;color:#928374;"># The delay until the next try is performed for a failed job. This
</span><span style="color:#fdf4c1;">    </span><span style="font-style:italic;color:#928374;"># delay is increased exponentially with the number of retries.
</span><span style="color:#fdf4c1;">    retry-delay = </span><span style="color:#b8bb26;">&quot;1 minute&quot;
</span><span style="color:#fdf4c1;">
</span><span style="color:#fdf4c1;">    </span><span style="font-style:italic;color:#928374;"># The queue size of log statements from a job.
</span><span style="color:#fdf4c1;">    log-buffer-size = 500
</span><span style="color:#fdf4c1;">
</span><span style="color:#fdf4c1;">    </span><span style="font-style:italic;color:#928374;"># If no job is left in the queue, the scheduler will wait until a
</span><span style="color:#fdf4c1;">    </span><span style="font-style:italic;color:#928374;"># notify is requested (using the REST interface). To also retry
</span><span style="color:#fdf4c1;">    </span><span style="font-style:italic;color:#928374;"># stuck jobs, it will notify itself periodically.
</span><span style="color:#fdf4c1;">    wakeup-period = </span><span style="color:#b8bb26;">&quot;30 minutes&quot;
</span><span style="color:#fdf4c1;">  }
</span><span style="color:#fdf4c1;">}
</span></code></pre>
<p>The <code>pool-size</code> setting determines how many jobs run in parallel. You
need to play with this setting on your machine to find an optimal
value.</p>
<p>The <code>counting-scheme</code> determines for all collectives how to select
between high and low priority jobs; as explained above. It is
currently not possible to define that per collective.</p>
<p>If a job fails, it will be set to <em>stuck</em> state and retried by the
scheduler. The <code>retries</code> setting defines how many times a job is
retried until it enters the final <em>failed</em> state. The scheduler waits
some time until running the next try. This delay is given by
<code>retry-delay</code>. This is the initial delay, the time until the first
re-try (the second attempt). This time increases exponentially with
the number of retries.</p>
<p>The jobs will log about what they do, which is picked up and stored
into the database asynchronously. The log events are buffered in a
queue and another thread will consume this queue and store them in the
database. The <code>log-buffer-size</code> determines the size of the queue.</p>
<p>At last, there is a <code>wakeup-period</code> that determines at what interval
the joex component notifies itself to look for new jobs. If jobs get
stuck, and joex is not notified externally it could miss to
retry. Also, since networks are not reliable, a notification may not
reach a joex component. This periodic wakup is just to ensure that
jobs are eventually run.</p>
<h1 id="periodic-tasks">Periodic Tasks<a class="zola-anchor" href="#periodic-tasks" aria-label="Anchor link for: periodic-tasks">ðŸ”—</a></h1>
<p>The job executor can execute tasks periodically. These tasks are
stored in the database such that they can be submitted into the job
queue. Multiple job executors can run at once, only one is ever doing
something with a task. So a periodic task is never submitted twice. It
is also not submitted, if a previous task has not finished yet.</p>
<h1 id="starting-on-demand">Starting on demand<a class="zola-anchor" href="#starting-on-demand" aria-label="Anchor link for: starting-on-demand">ðŸ”—</a></h1>
<p>The job executor and rest server can be started multiple times. This
is especially useful for the job executor. For example, when
submitting a lot of files in a short time, you can simply startup more
job executors on other computers on your network. Maybe use your
laptop to help with processing for a while.</p>
<p>You have to make sure, that all connect to the same database, and that
all have unique <code>app-id</code>s.</p>
<p>Once the files have been processced you can stop the additional
executors.</p>
<h1 id="shutting-down">Shutting down<a class="zola-anchor" href="#shutting-down" aria-label="Anchor link for: shutting-down">ðŸ”—</a></h1>
<p>If a job executor is sleeping and not executing any jobs, you can just
quit using SIGTERM or <code>Ctrl-C</code> when running in a terminal. But if
there are jobs currently executing, it is advisable to initiate a
graceful shutdown. The job executor will then stop taking new jobs
from the queue but it will wait until all running jobs have completed
before shutting down.</p>
<p>This can be done by sending a http POST request to the api of this job
executor:</p>
<pre style="background-color:#282828;color:#fdf4c1aa;"><code><span>curl -XPOST &quot;http://localhost:7878/api/v1/shutdownAndExit&quot;
</span></code></pre>
<p>If joex receives this request it will immediately stop taking new jobs
and it will quit when all running jobs are done.</p>
<p>If a job executor gets terminated while there are running jobs, the
jobs are still in the current state marked to be executed by this job
executor. In order to fix this, start the job executor again. It will
search all jobs that are marked with its id and put them back into
waiting state. Then send a graceful shutdown request as shown above.</p>

                        </div>
                    </div>
                </div>
            </div>
        </section>

        <footer class="footer">
    <div class="container">
        <div class="content has-text-centered">
            <span>
                Docspell 0.29.0
            </span>
            <span class="ml-1 mr-1">â€¢</span>
            <a href="https://spdx.org/licenses/AGPL-3.0-or-later.html" target="_blank">AGPLv3+</a>
            <span class="ml-1 mr-1">â€¢</span>
            <a href="https://github.com/eikek/docspell" target="_blank">
                Source Code
            </a>
            <span class="ml-1 mr-1">â€¢</span>
            <span>
                Chat on <a href="https://gitter.im/eikek/docspell">Gitter</a>/<a href="https://app.element.io/#/room/#eikek_docspell:gitter.im">Matrix</a>
            </span>
        </div>
    </div>
    
</footer>

        <script type="text/javascript" src="https://docspell.org/elasticlunr.min.js"></script>
<script type="text/javascript" src="https://docspell.org/search_index.en.js"></script>
<script type="text/javascript" src="https://docspell.org/js/searchhelper.js"></script>
<script type="text/javascript" src="https://docspell.org/js/bundle.js"></script>

        <script>
 var initSearch = function() {
     var elmSearch = Elm.Search.init({
         node: document.getElementById("search"),
         flags: {}
     });
     initElmSearch(elmSearch);
 }
 if (document.readyState === "complete" ||
     (document.readyState !== "loading" && !document.documentElement.doScroll)
 ) {
     initSearch();
 } else {
     document.addEventListener("DOMContentLoaded", initSearch);
 }
</script>

        <!-- Fathom - simple website analytics - https://github.com/usefathom/fathom -->
<script>
 (function(f, a, t, h, o, m){
     a[h]=a[h]||function(){
         (a[h].q=a[h].q||[]).push(arguments)
     };
     o=f.createElement('script'),
     m=f.getElementsByTagName('script')[0];
     o.async=1; o.src=t; o.id='fathom-script';
     m.parentNode.insertBefore(o,m)
 })(document, window, '//webstats.daheim.site/tracker.js', 'fathom');
 fathom('set', 'siteId', 'OGJDF');
 fathom('trackPageview');
</script>
<!-- / Fathom -->

    </body>
</html>
